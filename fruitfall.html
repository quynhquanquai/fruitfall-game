<!DOCTYPE html>
<html>
<head>
    <title>Há»©ng TÃ¡o Game - Final Version</title>
    <style>
        body { text-align: center; background-color: #ffe4e1; color: #d81b60; font-family: 'Arial', sans-serif; margin: 0; padding: 20px; }
        canvas { background: #ffffff; border: 8px solid #f8bbd0; border-radius: 20px; cursor: none; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        #game-container { position: relative; display: inline-block; }
        #overlay { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.9); 
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            border-radius: 12px; z-index: 10;
        }
        .instruction { font-size: 16px; color: #555; margin-bottom: 20px; line-height: 1.6; }
        button { 
            padding: 15px 40px; font-size: 24px; cursor: pointer; 
            background: #ff80ab; color: white; border: none; border-radius: 50px; font-weight: bold;
            box-shadow: 0 4px 10px rgba(255, 128, 171, 0.4);
        }
        button:hover { background: #f50057; }
        .score-board { font-size: 24px; margin-bottom: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ğŸ èŒ¹ç“Šçš„éŠæˆ² ğŸ</h1>
    <div class="score-board">Score: <span id="scoreVal">0</span></div>
    
    <div id="game-container">
        <canvas id="gameCanvas" width="400" height="550"></canvas>
        <div id="overlay">
            <h2 style="color: #ad1457;">æº–å‚™å¥½äº†å—ï¼Ÿ</h2>
            <div class="instruction">
                ğŸ åƒè˜‹æœ: +1 <br>
                ğŸ’£ ä¸­ç‚¸å½ˆ: -2 <br>
                ğŸš« æ¼æ‰: <b>å“å‘€ï¼Œè¼¸å•¦ï¼</b>
            </div>
            <button id="startBtn">é–‹å§‹éŠæˆ² (Start)</button>
        </div>
    </div>

    <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreDisplay = document.getElementById("scoreVal");
    const startBtn = document.getElementById("startBtn");

    const imgApple = new Image(); imgApple.src = 'tao.png';
    const imgBomb = new Image(); imgBomb.src = 'bom.png';
    const imgBasket = new Image(); imgBasket.src = 'gio.png';
    const bgMusic = new Audio('nhac.mp3');
    bgMusic.loop = true;

    let score = 0;
    let basketX = 160;
    let items = [];
    let gameActive = false;
    
    // CÃ¡c biáº¿n cho hiá»‡u á»©ng chá»¯ hiá»‡n lÃªn
    let feedbackText = ""; 
    let feedbackTimer = 0;
    let feedbackColor = "";

    startBtn.onclick = function() {
        document.getElementById('overlay').style.display = 'none';
        gameActive = true;
        score = 0;
        items = [];
        scoreDisplay.innerText = "0";
        bgMusic.play().catch(e => console.log("Lá»—i nháº¡c"));
        requestAnimationFrame(draw);
    };

    canvas.addEventListener("mousemove", (e) => {
        let rect = canvas.getBoundingClientRect();
        basketX = e.clientX - rect.left - 40;
    });

    function draw() {
        if (!gameActive) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (imgBasket.complete && imgBasket.naturalWidth !== 0) {
            ctx.drawImage(imgBasket, basketX, canvas.height - 70, 80, 60);
        } else {
            ctx.fillStyle = "#ec407a";
            ctx.fillRect(basketX, canvas.height - 40, 80, 20);
        }

        if (Math.random() < 0.02) {
            items.push({ x: Math.random() * 360, y: -50, speed: 3 + (score/15), type: Math.random() < 0.2 ? 'bomb' : 'apple' });
        }

        for (let i = 0; i < items.length; i++) {
            let it = items[i];
            it.y += it.speed;

            let currentImg = it.type === 'apple' ? imgApple : imgBomb;
            if (currentImg.complete && currentImg.naturalWidth !== 0) {
                ctx.drawImage(currentImg, it.x, it.y, 40, 40);
            } else {
                ctx.fillStyle = it.type === 'apple' ? "red" : "black";
                ctx.beginPath(); ctx.arc(it.x + 20, it.y + 20, 15, 0, Math.PI * 2); ctx.fill();
            }

            if (it.y > canvas.height - 70 && it.x > basketX - 20 && it.x < basketX + 80) {
                if (it.type === 'apple') { 
                    score++; 
                    feedbackText = "è®š";
                    feedbackColor = "#4caf50";
                    feedbackTimer = 20; 
                } else { 
                    score = Math.max(0, score - 2); 
                    feedbackText = "-2"; // HIá»†N -2 KHI TRÃšNG BOM
                    feedbackColor = "#ff0000";
                    feedbackTimer = 20;
                }
                scoreDisplay.innerText = score;
                items.splice(i, 1); i--;
            } 
            else if (it.y > canvas.height) {
                if (it.type === 'apple') {
                    gameActive = false;
                    bgMusic.pause();
                    alert("å“å‘€ï¼ŒéŒ¯éäº†ï¼\n\nå“å‘€ï¼Œè¼¸å•¦ï¼\nå¾—åˆ†: " + score);
                    document.location.reload();
                }
                items.splice(i, 1); i--;
            }
        }

        // Váº½ hiá»‡u á»©ng chá»¯ hiá»‡n lÃªn (è®š hoáº·c -2)
        if (feedbackTimer > 0) {
            ctx.fillStyle = feedbackColor;
            ctx.font = "bold 30px Arial";
            ctx.fillText(feedbackText, basketX + 25, canvas.height - 80);
            feedbackTimer--;
        }

        requestAnimationFrame(draw);
    }
</script>
</body>
</html>